<source>
  @type tail
  path /var/log/containers/*.log
  # Persistance (so that logs are continuous) and write position file to host file system
  pos_file /fluentd/fluentd-containers.log.pos
  tag oms.containerinsights.log.la
  @log_level trace
  read_from_head false
  path_key tailed_path
  <parse>
    # when log entry is json, does it work?(proably needs a setting)
	  @type  json
    keep_time_key true
  </parse>
</source>

# Time of generation and time of ingetion (look at the difference)

# Can windows update happen? it can break fluent-bit/fluentd possibly

# [PARSER]
#     Name         docker
#     Format       json
#     Time_Key     time
#     Time_Format  %Y-%m-%dT%H:%M:%S.%L
#     Time_Keep    On
#     # Command      |  Decoder | Field | Optional Action
#     # =============|==================|=================
#     Decode_Field_As   escaped    log

<filter  oms.containerinsights.log.la>
  @type record_transformer
  # Is this safe to do? fluent-plugin-record-modifier more light-weight but needs to be installed (dependency worth it?)
  remove_keys tailed_path
  <record>
    filepath ${record["tailed_path"]}
  </record>
</filter>

<match oms.containerinsights.log.la>
  @type forward
  send_timeout 60s
  recover_wait 10s
  hard_timeout 60s
  heartbeat_type none
  ignore_network_errors_at_startup true

  <server>
    name logaggregationserver
    host 127.0.0.1
    port 25227
    weight 60
  </server>
</match>